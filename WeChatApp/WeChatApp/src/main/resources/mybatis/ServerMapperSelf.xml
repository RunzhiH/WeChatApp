<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jisu.WeChatApp.daoSelf.ServerMapperSelf">
	<select id="getAllServerList" resultType="Map">
		SELECT 
		  a.*,
		  b.server_class_name,
		  IF(server_type=1,'参考价','需咨询') server_type_str
		FROM
		  shop_server a,
		  server_class b 
		WHERE a.server_class_id = b.server_class_id 
	</select>
	<select id="getServerMemberByOrderId" parameterType="String" resultType="Map">
		SELECT 
		  c.member_no,
		  d.nickname,
		  d.phone,
		  CONCAT(d.nickname, "--", d.phone) server_name_phone 
		FROM
		  order_info a,
		  shop_server b,
		  server_member_info c,
		  member_info d 
		WHERE a.shop_server_id = b.shop_server_id 
		  AND LOCATE(
		    b.server_class_id,
		    c.server_class_id_str
		  ) > 0 
		  AND c.member_no = d.member_no 
		  AND c.order_takes_type IN (1, 2)
		  AND a.order_id= #{order_id}
	</select>
	<select id="getServerListByClassId" parameterType="String" resultType="Map">
		select * from shop_server where server_class_id= '${server_class_id}'
	</select>
	<select id="getFreeServerMemberList" parameterType="String" resultType="Map">
		SELECT 
		  b.*,
		  c.nickname,
		  c.photo,
		  c.phone 
		FROM
		  shop_server a,
		  server_member_info b,
		  member_info c 
		WHERE b.member_no = c.member_no 
		  AND LOCATE(
		    a.server_class_id,
		    b.server_class_id_str
		  ) > 0 
		  AND b.order_takes_type != 0 
		  AND b.in_prohi = 0 
		  AND a.shop_server_id = '${shop_server_id}' 
	</select>
	<select id="getProhiMemberList" resultType="Map">
		SELECT 
		  * 
		FROM
		  member_prohi 
		WHERE prohi_status = 0 
		  AND DATE_ADD(
		    create_time,
		    INTERVAL prohi_time HOUR
		  ) > NOW()
	</select>
	<select id="getAppointmentServerTimeList" parameterType="String" resultType="Map">
		SELECT 
		  DATE_FORMAT(b.appointment_time_start, '%d') appointment_time_start,
		  DATE_FORMAT(b.appointment_time_end, '%d') appointment_time_end,
		  DATE_FORMAT(
		    b.appointment_time_start,
		    '%Y-%m-%d'
		  ) the_day 
		FROM
		  member_info a,
		  order_info b 
		WHERE a.member_no = b.server_member_no 
		  AND a.member_no = '${member_no}' 
		  AND b.order_status IN (1, 8)
	</select>
</mapper>